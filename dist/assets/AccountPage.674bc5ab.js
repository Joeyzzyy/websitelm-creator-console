import{_ as we,ae as ve,af as he,D as _e,Z as ye,W as pe,ag as Pe,ah as be,r as g,x as N,z as Ce,B as Ee,o as ke,a as y,aa as i,h as X,w as c,u as Fe,a3 as Q,ai as Ie,d as p,e as f,b as l,f as o,c as w,t as m,g as F,k as P,F as B,n as $,p as ee,a4 as ae,ab as Se}from"./index.3dd1b234.js";const De={name:"AccountPage",components:{PageLayout:ve,SettingOutlined:he,DeleteOutlined:_e,ReloadOutlined:ye,CloseOutlined:pe,NoSiteConfigured:Pe,SmartBanner:be},setup(){const q=Se.PROJECT_ID,s=g(0),h=g(null),e=Fe(),G=()=>{e.push("/dashboard")},A=g("login-email"),O=g(!1),v=g(null),D=g(!1),b=async()=>{D.value=!0;try{await Y(),i.success("Refresh successfully")}catch{i.error("Refresh failed")}finally{D.value=!1}},I=g(localStorage.getItem("currentCustomerEmail")||""),C=g(!1),d=g({newEmail:"",code:""}),S=g(!1),k=g(!1),U=N(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.value.newEmail)),V=N(()=>U.value&&d.value.code.length>0),n=()=>{C.value=!0},x=async()=>{if(d.value.newEmail===I.value){i.error("Please enter a different email address from your current one");return}S.value=!0;try{const t=await y.sendEmailCode(d.value.newEmail,"change_email");console.log("\u5F00\u59CB\u5012\u8BA1\u65F6"),s.value=60,console.log("\u5F53\u524Dcooldown\u503C:",s.value),h.value=setInterval(()=>{s.value--,console.log("\u5012\u8BA1\u65F6:",s.value),s.value<=0&&clearInterval(h.value)},1e3),(t==null?void 0:t.code)===200?i.success("Code sent successfully"):i.error("Error sending code")}catch(t){console.error("Error sending code:",t),i.error("Error sending code, please try again later")}finally{S.value=!1}},oe=()=>{Q.confirm({title:"Confirm Email Change",content:d.value.newEmail.includes("gmail.com")?"After changing, the original email account will no longer be able to log in this account. Do you want to continue?":"Are you sure you want to change your login email?",okText:"Confirm",cancelText:"Cancel",async onOk(){var t,a;k.value=!0;try{const r=await y.changeEmail({newEmail:d.value.newEmail,code:d.value.code});if((r==null?void 0:r.code)===200){I.value=d.value.newEmail,localStorage.setItem("currentCustomerEmail",d.value.newEmail),C.value=!1,d.value={newEmail:"",code:""},i.success("Successfully changed email");let u=3;const T=Q.success({title:"Success",content:`You will be logged out in ${u} seconds, please use the new email to log in`,okText:"OK",keyboard:!1,maskClosable:!1}),E=setInterval(()=>{u-=1,T.update({content:`You will be logged out in ${u} seconds, please use the new email to log in`}),u<=0&&(clearInterval(E),T.destroy(),localStorage.removeItem("authToken"),localStorage.removeItem("intelickIsLoggedIn"),localStorage.removeItem("currentCustomer"),localStorage.removeItem("currentCustomerId"),e.push("/login"),i.success("Logged out, please use the new email to log in"))},1e3)}else(r==null?void 0:r.code)===400&&(r==null?void 0:r.message)==="Email already exists"?i.error("The new email address has already been registered, please try another one"):(r==null?void 0:r.code)===400&&(r==null?void 0:r.message)==="Invalid verification code"?i.error("The verification code is incorrect, please try again"):i.error("Failed to change email, please try again later")}catch(r){console.error("Failed to change email:",r),i.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to change email, please try again later")}finally{k.value=!1}}})},se=()=>{C.value=!1,d.value={newEmail:"",code:""}},R=g(!1),K=g(!1),M=async()=>{var t;K.value=!0;try{const a=localStorage.getItem("currentCustomerId"),r=await y.getProductsByCustomerId(a);(r==null?void 0:r.code)===200&&r.data?(v.value=r.data,R.value=((t=r.data)==null?void 0:t.domainStatus)||!1,R.value&&await Y()):(v.value=null,R.value=!1)}catch(a){console.error("Failed to load product information:",a),v.value=null,R.value=!1}finally{K.value=!1}},te=async t=>{var T;if(!(t!=null&&t.domains)||!((T=v.value)!=null&&T.projectWebsite))return;const a=v.value.projectWebsite,r=t.domains.filter(E=>E.apexName===a&&E.name!==a),u=await Promise.all(r.map(async E=>{try{const j=localStorage.getItem("currentCustomerId");let fe="nextjs";j==="67525da4ba5fcadf228e56c1"&&(fe="prj_7SXIhcIx5SOYKKVzhhRvnmUdoN7g");const J=await y.getVercelDomainConfig(E.name);return{...E,verified:J.verified||!1,configDetails:J}}catch(j){return console.error(`Failed to get config for domain ${E.name}:`,j),{...E,verified:!1,configDetails:null}}}));console.log("\u57DF\u540D\u914D\u7F6E\u66F4\u65B0\uFF1A",u)},Y=async()=>{try{const t=q,a=await y.getVercelDomainInfo(t);await te(a)}catch(t){console.error("Failed to load Vercel domain info:",t),i.error("Failed to load domain information")}};Ce(A,async t=>{if(t==="login-email")C.value=!1,d.value={newEmail:"",code:""};else if(t==="password")try{const a=await y.getUserInfo();(a==null?void 0:a.code)===200&&(v.value={...v.value,isFirstLogin:a.data.firstLogin})}catch(a){console.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25:",a),i.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25")}}),Ee(()=>{M(),ne()}),ke(()=>{h.value&&clearInterval(h.value)});const ne=async()=>{var t,a;try{const r=await y.getCustomerPackage();if(r!=null&&r.data){const u=r.data;Z.value={name:((t=u.packageName)==null?void 0:t.trim())||"Professional",period:(a=u.packageName)!=null&&a.toLowerCase().includes("monthly")?"monthly":"yearly",endDate:u.packageEndTime,remainingDays:u.remainingDays},H.value=[{label:"Outline Generator",used:u.outlineGeneratorUsage||0,total:u.outlineGeneratorLimit||999999999,unit:"times/month",description:"AI-powered outline generation"},{label:"Page Generator",used:u.pageGeneratorUsage||0,total:u.pageGeneratorLimit||999999999,unit:"times/month",description:"SEO-optimized page creation"},{label:"Internal Links Storage",used:u.internalLinkStorageUsage||0,total:u.internalLinkStorageLimit||999999999,unit:"links",description:"Store and manage internal link structure"},{label:"Free Page Deployment",used:u.freeDeploymentPageUsage||0,total:u.freeDeploymentPageLimit||999999999,unit:"times/year",description:"Number of pages that can be deployed"},{label:"Image Storage",used:u.imageStorageUsage||0,total:u.imageStorageLimit||999999999,unit:"images",description:"Store and optimize images"}]}}catch(r){console.error("Failed to load package information:",r),i.error("Failed to load subscription details")}},re=t=>{var a;return t.verified||!((a=t.configDetails)!=null&&a.misconfigured)?"success":"warning"},le=t=>{var a;return t.verified||!((a=t.configDetails)!=null&&a.misconfigured)?"Verified":"Pending"},z=g(),_=g({newPassword:"",confirmPassword:"",code:""}),L=g(!1),W=N(()=>{const t=_.value.newPassword;if(!t)return"";let a=0;switch(t.length>=8&&a++,/[A-Z]/.test(t)&&a++,/[a-z]/.test(t)&&a++,/\d/.test(t)&&a++,a){case 4:return"Strong";case 3:return"Medium";default:return"Weak"}}),ie=N(()=>{switch(W.value){case"Strong":return"strength-strong";case"Medium":return"strength-medium";case"Weak":return"strength-weak";default:return""}}),de=async(t,a)=>{if(!a)throw new Error("Please input your password!");if(a.length<8)throw new Error("Password must be at least 8 characters!");if(!/[A-Z]/.test(a))throw new Error("Password must contain at least one uppercase letter!");if(!/[a-z]/.test(a))throw new Error("Password must contain at least one lowercase letter!");if(!/\d/.test(a))throw new Error("Password must contain at least one number!")},ce=async(t,a)=>{if(!a)throw new Error("Please confirm your password!");if(a!==_.value.newPassword)throw new Error("The two passwords do not match!")},ue=async()=>{var t;try{await z.value.validate(),L.value=!0;const a=await y.changePassword({currentPassword:"",newPassword:_.value.newPassword,confirmPassword:_.value.confirmPassword,isInitPassword:!0});(a==null?void 0:a.code)===200?(i.success("Password set successfully"),await M(),_.value={newPassword:"",confirmPassword:"",code:""}):i.error(a.message||"Password setting failed")}catch(a){(t=a.response)!=null&&t.data?i.error(a.response.data.message||"Password setting failed"):i.error("Password setting failed")}finally{L.value=!1}},me=async()=>{var t;try{await z.value.validate(),L.value=!0;const a=await y.resetPassword({email:I.value,code:_.value.code,newPassword:_.value.newPassword,confirmPassword:_.value.confirmPassword});(a==null?void 0:a.code)===200?(i.success("Password changed successfully"),_.value={code:"",newPassword:"",confirmPassword:""},s.value=0,h.value&&(clearInterval(h.value),h.value=null)):(a==null?void 0:a.code)===400&&(a.message==="Invalid verification code"?i.error("The verification code is incorrect"):i.error(a.message||"Failed to change password"))}catch(a){(t=a.response)!=null&&t.data?i.error(a.response.data.message||"Failed to change password"):i.error("Failed to change password")}finally{L.value=!1}},ge=async()=>{try{await y.sendEmailCode(I.value,"forgot_password"),s.value=60,h.value=setInterval(()=>{s.value--,s.value<=0&&clearInterval(h.value)},1e3),i.success("Verification code has been sent to your email")}catch{i.error("Failed to send verification code")}},Z=g({name:"",period:"monthly",endDate:null,remainingDays:0}),H=g([]);return{cooldown:s,goToDashboard:G,activeTab:A,saving:O,productInfo:v,loadProductInfo:M,loadVercelDomainInfo:Y,currentEmail:I,showEmailForm:C,emailForm:d,sendingCode:S,changing:k,isValidEmail:U,canSubmit:V,showChangeEmailForm:n,sendVerificationCode:x,confirmEmailChange:oe,cancelEmailChange:se,getDomainStatusColor:re,getDomainStatusText:le,refreshing:D,handleRefresh:b,passwordForm:_,submitLoading:L,passwordStrength:W,passwordStrengthClass:ie,validatePassword:de,validateConfirmPassword:ce,handleSetPassword:ue,handleChangePassword:me,sendResetCode:ge,currentPlan:Z,usageInfo:H,formatDate:t=>Ie(t).format("YYYY-MM-DD"),formRef:z}}},xe={class:"settings-content"},Le={class:"page-content"},Te={class:"settings-content"},Ue={key:0,class:"account-settings"},Ve={class:"current-email-section"},Re={class:"email-display"},Ne={class:"current-email-text"},Be={key:0,class:"email-change-section"},Ae={class:"section-header"},Oe={class:"email-change-form"},Me={class:"email-input-group"},Ye={key:1,class:"settings-container"},ze={class:"current-email-section"},je={class:"email-display"},qe={class:"current-email-text"},Ge={class:"email-change-section"},Ke={class:"email-change-form"},We={key:0,class:"password-strength"},Ze={class:"current-email-section"},He={class:"email-display"},Je={class:"current-email-text"},Xe={class:"email-change-section"},Qe={class:"email-change-form"},$e={class:"email-input-group"},ea={key:0,class:"password-strength"},aa={key:2,class:"subscription-info"},oa={class:"current-plan"},sa={class:"plan-period"},ta={key:0,class:"plan-expiry"},na={class:"remaining-days"},ra={class:"usage-grid"},la={class:"usage-column"},ia={class:"usage-header"},da={class:"usage-label"},ca={class:"usage-description"},ua={class:"usage-stats"},ma={class:"usage-numbers"},ga={class:"font-medium"},fa={class:"usage-period"},wa={key:0,class:"usage-bar"},va={class:"usage-column"},ha={class:"usage-header"},_a={class:"usage-label"},ya={class:"usage-description"},pa={class:"usage-stats"},Pa={class:"usage-numbers"},ba={class:"font-medium"},Ca={class:"usage-period"},Ea={key:0,class:"usage-bar"};function ka(q,s,h,e,G,A){const O=p("smart-banner"),v=p("a-tab-pane"),D=p("a-tabs"),b=p("a-button"),I=p("close-outlined"),C=p("a-input"),d=p("a-form-item"),S=p("a-form"),k=p("a-input-password"),U=p("page-layout");return f(),X(U,{title:"Settings",description:"Configure your website settings and deployment options",icon:"\u2699\uFE0F"},{default:c(()=>{var V;return[l(O,{theme:{primary:"#7C3AED",secondary:"#EC4899",background:"linear-gradient(135deg, #F5F3FF, #FCE7F3)",textColor:"#2D3748",descriptionColor:"#4A5568",badgeColor:"#6B7280",badgeBackground:"rgba(124, 58, 237, 0.1)",badgeHoverBackground:"rgba(236, 72, 153, 0.1)",badgeHoverColor:"#EC4899",iconBackground:"rgba(124, 58, 237, 0.1)"},title:"Account Setting",description:"Configure your account settings, manage login email and password.",badges:[{text:"Login Email"},{text:"Password"},{text:"Plan Usage"}]}),o("div",xe,[l(D,{class:"main-tabs",activeKey:e.activeTab,"onUpdate:activeKey":s[0]||(s[0]=n=>e.activeTab=n)},{default:c(()=>[l(v,{key:"login-email",tab:"Login Email Setting"}),l(v,{key:"password",tab:"Password Setting"}),l(v,{key:"plan-usage",tab:"Plan Usage"})]),_:1},8,["activeKey"]),o("div",Le,[o("div",Te,[e.activeTab==="login-email"?(f(),w("div",Ue,[o("div",Ve,[s[9]||(s[9]=o("h3",null,"Current Login Email",-1)),o("div",Re,[o("p",Ne,m(e.currentEmail),1),e.showEmailForm?P("",!0):(f(),X(b,{key:0,type:"primary",onClick:e.showChangeEmailForm,class:"change-email-btn"},{default:c(()=>s[8]||(s[8]=[F(" Change Login Email ")])),_:1},8,["onClick"]))])]),e.showEmailForm?(f(),w("div",Be,[o("div",Ae,[s[10]||(s[10]=o("h3",null,"Change Login Email",-1)),l(b,{onClick:e.cancelEmailChange,class:"cancel-btn"},{default:c(()=>[l(I)]),_:1},8,["onClick"])]),o("div",Oe,[l(S,{model:e.emailForm,layout:"vertical"},{default:c(()=>[l(d,{label:"New Email Address",required:""},{default:c(()=>[o("div",Me,[l(C,{value:e.emailForm.newEmail,"onUpdate:value":s[1]||(s[1]=n=>e.emailForm.newEmail=n),placeholder:"Enter new email address",class:"custom-input"},null,8,["value"]),l(b,{type:"primary",loading:e.sendingCode,disabled:!e.isValidEmail||e.cooldown>0,onClick:e.sendVerificationCode,class:"send-code-btn"},{default:c(()=>[F(m(e.cooldown>0?`${e.cooldown}s`:"Send Code"),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1}),l(d,{label:"Verification Code",required:""},{default:c(()=>[l(C,{value:e.emailForm.code,"onUpdate:value":s[2]||(s[2]=n=>e.emailForm.code=n),placeholder:"Enter verification code",class:"custom-input"},null,8,["value"])]),_:1}),l(d,null,{default:c(()=>[l(b,{type:"primary",loading:e.changing,onClick:e.confirmEmailChange,disabled:!e.canSubmit,class:"save-btn"},{default:c(()=>s[11]||(s[11]=[F(" Change Now ")])),_:1},8,["loading","onClick","disabled"])]),_:1})]),_:1},8,["model"])])])):P("",!0)])):P("",!0),e.activeTab==="password"?(f(),w("div",Ye,[(V=e.productInfo)!=null&&V.isFirstLogin?(f(),w(B,{key:0},[o("div",ze,[s[12]||(s[12]=o("h3",null,"Set Your Password",-1)),o("div",je,[o("p",qe,m(e.currentEmail),1)])]),o("div",Ge,[s[15]||(s[15]=o("h3",null,"Create Password",-1)),o("div",Ke,[l(S,{ref:"formRef",model:e.passwordForm,layout:"vertical",class:"password-form",rules:{newPassword:[{required:!0,validator:e.validatePassword,trigger:"change"}],confirmPassword:[{required:!0,validator:e.validateConfirmPassword,trigger:"change"}]}},{default:c(()=>[l(d,{name:"newPassword",label:"New Password"},{default:c(()=>[l(k,{value:e.passwordForm.newPassword,"onUpdate:value":s[3]||(s[3]=n=>e.passwordForm.newPassword=n),placeholder:"Please input new password",class:"custom-input"},null,8,["value"]),e.passwordForm.newPassword?(f(),w("div",We,[s[13]||(s[13]=F(" Password Strength: ")),o("span",{class:$(e.passwordStrengthClass)},m(e.passwordStrength),3)])):P("",!0)]),_:1}),l(d,{name:"confirmPassword",label:"Confirm Password"},{default:c(()=>[l(k,{value:e.passwordForm.confirmPassword,"onUpdate:value":s[4]||(s[4]=n=>e.passwordForm.confirmPassword=n),placeholder:"Please confirm your password",class:"custom-input"},null,8,["value"])]),_:1}),l(d,null,{default:c(()=>[l(b,{type:"primary",loading:e.submitLoading,onClick:e.handleSetPassword,class:"change-email-btn"},{default:c(()=>s[14]||(s[14]=[F(" Set Password ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model","rules"])])])],64)):(f(),w(B,{key:1},[o("div",Ze,[s[16]||(s[16]=o("h3",null,"Change Your Password For",-1)),o("div",He,[o("p",Je,m(e.currentEmail),1)])]),o("div",Xe,[s[19]||(s[19]=o("h3",null,"Verify Identity",-1)),o("div",Qe,[l(S,{ref:"formRef",model:e.passwordForm,layout:"vertical",class:"password-form",rules:{newPassword:[{required:!0,validator:e.validatePassword,trigger:"change"}],confirmPassword:[{required:!0,validator:e.validateConfirmPassword,trigger:"change"}]}},{default:c(()=>[l(d,{label:"Verification Code",name:"code",rules:[{required:!0,message:"Please input verification code!"}]},{default:c(()=>[o("div",$e,[l(C,{value:e.passwordForm.code,"onUpdate:value":s[5]||(s[5]=n=>e.passwordForm.code=n),placeholder:"Please input verification code",class:"custom-input"},null,8,["value"]),l(b,{type:"primary",onClick:e.sendResetCode,disabled:e.cooldown>0,class:"send-code-btn"},{default:c(()=>[F(m(e.cooldown>0?`${e.cooldown}s`:"Send Code"),1)]),_:1},8,["onClick","disabled"])])]),_:1}),l(d,{name:"newPassword",label:"New Password"},{default:c(()=>[l(k,{value:e.passwordForm.newPassword,"onUpdate:value":s[6]||(s[6]=n=>e.passwordForm.newPassword=n),placeholder:"Please input new password",class:"custom-input"},null,8,["value"]),e.passwordForm.newPassword?(f(),w("div",ea,[s[17]||(s[17]=F(" Password Strength: ")),o("span",{class:$(e.passwordStrengthClass)},m(e.passwordStrength),3)])):P("",!0)]),_:1}),l(d,{name:"confirmPassword",label:"Confirm Password"},{default:c(()=>[l(k,{value:e.passwordForm.confirmPassword,"onUpdate:value":s[7]||(s[7]=n=>e.passwordForm.confirmPassword=n),placeholder:"Please confirm your password",class:"custom-input"},null,8,["value"])]),_:1}),l(d,null,{default:c(()=>[l(b,{type:"primary",loading:e.submitLoading,onClick:e.handleChangePassword,class:"change-email-btn"},{default:c(()=>s[18]||(s[18]=[F(" Change Password ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model","rules"])])])],64))])):P("",!0),e.activeTab==="plan-usage"?(f(),w("div",aa,[o("div",oa,[o("h3",null,m(e.currentPlan.name)+" Plan",1),o("div",sa,m(e.currentPlan.period==="monthly"?"Monthly Billing":"Annual Billing"),1),e.currentPlan.endDate?(f(),w("div",ta,[o("span",null,"Expires: "+m(e.formatDate(e.currentPlan.endDate)),1),o("span",na,"("+m(e.currentPlan.remainingDays)+" days remaining)",1)])):P("",!0)]),o("div",ra,[o("div",la,[(f(!0),w(B,null,ee(e.usageInfo.slice(0,Math.ceil(e.usageInfo.length/2)),(n,x)=>(f(),w("div",{key:x,class:"usage-item"},[o("div",ia,[o("div",da,m(n.label),1),o("div",ca,m(n.description),1)]),o("div",ua,[o("div",ma,[o("span",ga,m(n.total===999999999?"Unlimited":`${n.used}/${n.total}`),1)]),o("div",fa,m(n.total===999999999?"":n.unit),1)]),n.total!==999999999?(f(),w("div",wa,[o("div",{class:"usage-progress",style:ae({width:`${n.used/n.total*100}%`,background:n.used/n.total>.9?"#ff4d4f":"#1890ff"})},null,4)])):P("",!0)]))),128))]),o("div",va,[(f(!0),w(B,null,ee(e.usageInfo.slice(Math.ceil(e.usageInfo.length/2)),(n,x)=>(f(),w("div",{key:x,class:"usage-item"},[o("div",ha,[o("div",_a,m(n.label),1),o("div",ya,m(n.description),1)]),o("div",pa,[o("div",Pa,[o("span",ba,m(n.total===999999999?"Unlimited":`${n.used}/${n.total}`),1)]),o("div",Ca,m(n.total===999999999?"":n.unit),1)]),n.total!==999999999?(f(),w("div",Ea,[o("div",{class:"usage-progress",style:ae({width:`${n.used/n.total*100}%`,background:n.used/n.total>.9?"#ff4d4f":"#1890ff"})},null,4)])):P("",!0)]))),128))])])])):P("",!0)])])])]}),_:1})}const Sa=we(De,[["render",ka],["__scopeId","data-v-0030148f"]]);export{Sa as default};
